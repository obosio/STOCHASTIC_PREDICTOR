# ══════════════════════════════════════════════════════════════════════════
# Universal Stochastic Predictor - Environment Configuration Template
# ══════════════════════════════════════════════════════════════════════════
# 
# CRITICAL: This file demonstrates the REQUIRED naming convention for 
# environment variable overrides in production deployments.
#
# Convention: USP_SECTION__KEY (double underscore separator)
#   - USP: Universal Stochastic Predictor prefix (mandatory)
#   - SECTION: Config section from config.toml (core, orchestration, kernels, meta)
#   - KEY: Configuration key within that section (uppercase in env vars)
#
# Single Source of Truth:
#   This file synchronizes with FIELD_TO_SECTION_MAP in stochastic_predictor/api/config.py
#   All field→section mappings are auto-validated at runtime.
#
# Example:
#   config.toml:  [core]
#                 staleness_ttl_ns = 500000000
#   
#   Override:     USP_CORE__STALENESS_TTL_NS=1000000000
#
# Security Policy:
#   - NEVER commit .env with actual secrets (copy this to .env and edit)
#   - Use environment variable injection pattern per doc/Predictor_Estocastico_IO.tex §2.2
#   - Store production secrets in vault/secrets manager
#
# References:
#   - FIELD_TO_SECTION_MAP in stochastic_predictor/api/config.py (line ~143)
#   - ConfigManager._apply_env_overrides() (automatic env→config.toml merge)
#   - Predictor_Estocastico_Implementacion.tex §1.2
# ══════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────
# JAX Runtime Configuration
# ─────────────────────────────────────────────────────────────────────────
# These are JAX-specific environment variables (NOT using USP_ prefix)
# as they are consumed directly by JAX at import time.

# Force CPU-only execution (override GPU detection)
# JAX_PLATFORMS=cpu

# Enable 64-bit precision (required for Malliavin calculus and signatures)
# JAX_ENABLE_X64=1

# Deterministic reductions (required for reproducibility)
# JAX_DETERMINISTIC_REDUCTIONS=1

# Default PRNG implementation (required: threefry2x32 for determinism)
# JAX_DEFAULT_PRNG_IMPL=threefry2x32

# Compilation cache directory (accelerates repeated runs)
# JAX_COMPILATION_CACHE_DIR=/tmp/jax_cache

# ─────────────────────────────────────────────────────────────────────────
# Core System Configuration (USP_CORE__)
# ─────────────────────────────────────────────────────────────────────────

# Staleness TTL in nanoseconds (500ms default, degraded mode threshold)
# USP_CORE__STALENESS_TTL_NS=500000000

# ─────────────────────────────────────────────────────────────────────────
# Orchestration Parameters (USP_ORCHESTRATION__)
# ─────────────────────────────────────────────────────────────────────────

# Entropic regularization (Sinkhorn epsilon)
# USP_ORCHESTRATION__EPSILON=0.001

# JKO learning rate (tau parameter for optimal transport gradient descent)
# USP_ORCHESTRATION__LEARNING_RATE=0.01

# Sinkhorn volatility coupling parameters
# USP_ORCHESTRATION__SINKHORN_EPSILON_MIN=0.01
# USP_ORCHESTRATION__SINKHORN_EPSILON_0=0.1
# USP_ORCHESTRATION__SINKHORN_ALPHA=0.5

# Entropy monitoring (mode collapse detection)
# USP_ORCHESTRATION__ENTROPY_WINDOW=100
# USP_ORCHESTRATION__ENTROPY_THRESHOLD=0.8

# Outlier detection (Black Swan threshold in number of sigmas)
# USP_ORCHESTRATION__SIGMA_BOUND=20.0

# Reference standard deviation for outlier detection
# USP_ORCHESTRATION__SIGMA_VAL=1.0

# Temporal drift validation (clock skew and stale data)
# USP_ORCHESTRATION__MAX_FUTURE_DRIFT_NS=1000000000  # 1 second
# USP_ORCHESTRATION__MAX_PAST_DRIFT_NS=86400000000000  # 24 hours

# Hölder threshold (circuit breaker for singularity detection)
# USP_ORCHESTRATION__HOLDER_THRESHOLD=0.4

# CUSUM drift threshold (h parameter for regime change detection)
# USP_ORCHESTRATION__CUSUM_H=5.0

# CUSUM slack tolerance (k parameter, 0 to h range)
# USP_ORCHESTRATION__CUSUM_K=0.5

# Grace period steps (refractory period post-alarm to avoid flapping)
# USP_ORCHESTRATION__GRACE_PERIOD_STEPS=20

# Volatility EWMA decay factor (alpha parameter, 0 to 1)
# USP_ORCHESTRATION__VOLATILITY_ALPHA=0.1

# Inference recovery hysteresis factor (prevents oscillations near threshold)
# USP_ORCHESTRATION__INFERENCE_RECOVERY_HYSTERESIS=0.8

# ─────────────────────────────────────────────────────────────────────────
# Kernel Parameters (USP_KERNELS__)
# ─────────────────────────────────────────────────────────────────────────

# Log-signature truncation depth (L parameter, exponential complexity O(d^L))
# USP_KERNELS__LOG_SIG_DEPTH=3

# WTMM buffer size (sliding window memory for wavelet analysis)
# USP_KERNELS__WTMM_BUFFER_SIZE=128

# Besov cone of influence (C parameter for multifractal analysis)
# USP_KERNELS__BESOV_CONE_C=1.5

# Besov-Nyquist interval in nanoseconds (100ms default for WTMM anti-aliasing)
# USP_KERNELS__BESOV_NYQUIST_INTERVAL_NS=100000000

# SDE integration stiffness thresholds (Kernel C scheme switching)
# USP_KERNELS__STIFFNESS_LOW=100
# USP_KERNELS__STIFFNESS_HIGH=1000

# SDE integration timestep and number of integrations
# USP_KERNELS__SDE_DT=0.01
# USP_KERNELS__SDE_NUMEL_INTEGRATIONS=100

# ─────────────────────────────────────────────────────────────────────────
# I/O Policies (USP_IO__)
# ─────────────────────────────────────────────────────────────────────────

# Market feed timeout in seconds
# USP_IO__MARKET_FEED_TIMEOUT=30

# Maximum retry attempts for market feed connection
# USP_IO__MARKET_FEED_MAX_RETRIES=3

# Snapshot atomicity (force fsync for crash consistency)
# USP_IO__SNAPSHOT_ATOMIC_FSYNC=true

# Snapshot compression algorithm ("none", "gzip", or "brotli")
# USP_IO__SNAPSHOT_COMPRESSION=none

# ─────────────────────────────────────────────────────────────────────────
# Metadata Configuration (USP_META__)
# ─────────────────────────────────────────────────────────────────────────

# Schema version (for backward compatibility in snapshot restoration)
# USP_META__SCHEMA_VERSION=1.0

# ─────────────────────────────────────────────────────────────────────────
# External APIs & Secrets (DO NOT USE USP_ PREFIX)
# ─────────────────────────────────────────────────────────────────────────

# Market Data API credentials
# BINANCE_API_KEY=your_api_key_here
# BINANCE_API_SECRET=your_api_secret_here
# MARKET_FEED_API_KEY=your_key_here
# MARKET_FEED_API_SECRET=your_secret_here

# Database credentials
# DATABASE_URL=postgresql://user:password@localhost:5432/stochastic_predictor
# DATABASE_PASSWORD=secure_password_here

# Logging configuration
# LOG_LEVEL=INFO
# LOG_FILE=/var/log/stochastic_predictor/app.log

# ─────────────────────────────────────────────────────────────────────────
# Deployment-Specific Overrides (Examples)
# ─────────────────────────────────────────────────────────────────────────

# Production: Tighter staleness constraint
# USP_CORE__STALENESS_TTL_NS=100000000  # 100ms

# GPU Production: Force GPU execution
# JAX_PLATFORMS=cuda

# Testing: Aggressive circuit breaker for vulnerability testing
# USP_ORCHESTRATION__HOLDER_THRESHOLD=0.3

# High-Frequency Trading: Faster Nyquist sampling
# USP_KERNELS__BESOV_NYQUIST_INTERVAL_NS=10000000  # 10ms

